<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Component Gallery - Tapendos</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .component-gallery {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .component-section {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }

        .component-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007acc;
        }

        .component-title {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: #007acc;
        }

        .component-description {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        .component-demo {
            background: white;
            border-radius: 4px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .component-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 4px;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .control-group input, .control-group select, .control-group button {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .control-group button {
            background: #007acc;
            color: white;
            cursor: pointer;
        }

        .control-group button:hover {
            background: #005999;
        }

        .mount-point {
            border: 1px dashed #ccc;
            padding: 10px;
            background: #fafafa;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <div class="component-gallery">
        <h1>Live Component Gallery</h1>
        <p>This page renders actual components using their real code for development testing.</p>

        <!-- Status Display Component -->
        <div class="component-section">
            <div class="component-header">
                <h2 class="component-title">StatusDisplay</h2>
                <p class="component-description">Shows connection status and messages</p>
            </div>
            <div class="component-demo">
                <div class="mount-point" id="status-mount"></div>
            </div>
            <div class="component-controls">
                <div class="control-group">
                    <label>Test Status:</label>
                    <button onclick="updateStatus(null)">Null Status</button>
                    <button onclick="updateStatus({})">Empty Status</button>
                    <button onclick="updateStatus({text: 'Connected', className: 'connected'})">Connected</button>
                    <button onclick="updateStatus({text: 'Connection failed', className: 'error'})">Error</button>
                </div>
            </div>
        </div>

        <!-- Button Group Component -->
        <div class="component-section">
            <div class="component-header">
                <h2 class="component-title">ButtonGroup</h2>
                <p class="component-description">Connection buttons and vibration controls</p>
            </div>
            <div class="component-demo">
                <div class="mount-point" id="button-mount"></div>
            </div>
            <div class="component-controls">
                <div class="control-group">
                    <label>Connection State:</label>
                    <button onclick="updateConnection({leftConnected: false, rightConnected: false, leftVibrating: false, rightVibrating: false, isVibrating: false})">Disconnected</button>
                    <button onclick="updateConnection({leftConnected: true, rightConnected: false, leftVibrating: false, rightVibrating: false, isVibrating: false})">Left Only</button>
                    <button onclick="updateConnection({leftConnected: true, rightConnected: true, leftVibrating: false, rightVibrating: false, isVibrating: false})">Both Connected</button>
                    <button onclick="updateConnection({leftConnected: true, rightConnected: true, leftVibrating: true, rightVibrating: true, isVibrating: true})">Vibrating</button>
                </div>
            </div>
        </div>

        <!-- Info Section Component -->
        <div class="component-section">
            <div class="component-header">
                <h2 class="component-title">InfoSection</h2>
                <p class="component-description">Help and connection instructions</p>
            </div>
            <div class="component-demo">
                <div class="mount-point" id="info-mount"></div>
            </div>
            <div class="component-controls">
                <div class="control-group">
                    <button onclick="updateInfoExpanded(false)">Collapsed</button>
                    <button onclick="updateInfoExpanded(true)">Expanded</button>
                </div>
            </div>
        </div>

        <!-- Controls Component -->
        <div class="component-section">
            <div class="component-header">
                <h2 class="component-title">Controls</h2>
                <p class="component-description">Preset selection and vibration settings</p>
            </div>
            <div class="component-demo">
                <div class="mount-point" id="controls-mount"></div>
            </div>
            <div class="component-controls">
                <div class="control-group">
                    <label>Advanced Controls:</label>
                    <button onclick="updateControlsVisibility(false)">Hidden</button>
                    <button onclick="updateControlsVisibility(true)">Visible</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Preact and HTM -->
    <script type="module">
        import { h, render } from 'https://esm.sh/preact';
        import htm from 'https://esm.sh/htm';

        const html = htm.bind(h);

        // Import our components (these will be transformed by the dev server)
        import { StatusDisplay } from './components/StatusDisplay.mjs';
        import { ButtonGroup } from './components/ButtonGroup.mjs';
        import { InfoSection } from './components/InfoSection.mjs';
        import { Controls } from './components/Controls.mjs';

        // Mock send function
        const mockSend = (action) => {
            console.log('Action dispatched:', action);
        };

        // Status Display
        let currentStatus = null;
        function updateStatus(status) {
            currentStatus = status;
            renderStatus();
        }

        function renderStatus() {
            render(
                StatusDisplay({ html, status: currentStatus }),
                document.getElementById('status-mount')
            );
        }

        // Button Group
        let currentConnection = { leftConnected: false, rightConnected: false, leftVibrating: false, rightVibrating: false, isVibrating: false };
        let currentVibration = { leftVibrating: false, rightVibrating: false, isVibrating: false };

        function updateConnection(connection) {
            currentConnection = connection;
            currentVibration = {
                leftVibrating: connection.leftVibrating,
                rightVibrating: connection.rightVibrating,
                isVibrating: connection.isVibrating
            };
            renderButtonGroup();
        }

        function renderButtonGroup() {
            render(
                ButtonGroup({ html, connection: currentConnection, vibration: currentVibration, send: mockSend }),
                document.getElementById('button-mount')
            );
        }

        // Info Section
        let infoExpanded = false;
        function updateInfoExpanded(expanded) {
            infoExpanded = expanded;
            renderInfo();
        }

        function renderInfo() {
            render(
                InfoSection({ html, isExpanded: infoExpanded, onToggle: () => updateInfoExpanded(!infoExpanded) }),
                document.getElementById('info-mount')
            );
        }

        // Controls
        let controlsVisible = false;
        const mockSettings = {
            lengthValue: 500,
            intensityValue: 0.8,
            pauseValue: 1000,
            repeatMode: 'unlimited',
            repeatCount: 5,
            repeatCountDisplay: '5',
            showRepeatCount: false
        };

        const mockPresets = {
            presetOptions: [
                { value: 'standard-processing', text: 'Standard Processing' },
                { value: 'gentle', text: 'Gentle' },
                { value: 'intense', text: 'Intense' },
                { value: 'custom', text: 'Custom' }
            ],
            selectedPreset: 'standard-processing',
            presetActive: true
        };

        function updateControlsVisibility(visible) {
            controlsVisible = visible;
            renderControls();
        }

        function renderControls() {
            render(
                Controls({ html, settings: mockSettings, presets: mockPresets, showAdvancedControls: controlsVisible, send: mockSend }),
                document.getElementById('controls-mount')
            );
        }

        // Initial renders
        renderStatus();
        renderButtonGroup();
        renderInfo();
        renderControls();

        // Make functions global for button onclicks
        window.updateStatus = updateStatus;
        window.updateConnection = updateConnection;
        window.updateInfoExpanded = updateInfoExpanded;
        window.updateControlsVisibility = updateControlsVisibility;
    </script>
</body>
</html>